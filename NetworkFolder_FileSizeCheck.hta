<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Vbscript File Size Check</title>
<HTA:APPLICATION 
	ID="FileSizerCLI"
	APPLICATIONNAME="FileSizingIT"
	SCROLL="yes"
	SINGLEINSTANCE="yes"
	maximizeButton="no" 
	minimizeButton="yes" 
	showInTaskbar="yes" 
	caption = "no"
	BORDERSTYLE="raised"
	BORDER="thick"
>
</head>

<SCRIPT Language="VBScript">
Public resultName

Sub Window_Onload
	self.Focus()
	self.ResizeTo 600,600
End Sub

Sub RunReload
    Location.Reload(True)
End Sub

Function LogOff()
	window.close
End Function

class filingName
	public name
end class 

Function resultNameNow ()
	dim m
	set m = new filingName
	If Len (month(now)) < 2 Then
		monthly = "0" & (month(now))
	Else
		monthly = (month(now))
	End If

	If Len (day(now)) < 2 Then
		dayly = "0" & (day(now))
	Else
		dayly = (day(now))
	End If

	If Len (hour(now)) < 2 Then
		hourly = "0" & (hour(now))
	Else
		hourly = (hour(now))
	End If

	If Len (minute(now)) < 2 Then
		minutely = "0" & (minute(now))
	Else
		minutely = (minute(now))
	End If

	If Len (second(now)) < 2 Then
		secondly = "0" & (second(now))
	Else
		secondly = (second(now))
	End If
	m.name = "FileSizeChecker_" & year(now) & monthly & dayly & "_" & hourly & minutely & secondly
	set resultNameNow = m
End Function

Sub MainSub
	Set m = resultNameNow()
	resultName = m.name
	sTxtarea = localVariables.TextAreaPcName.value
	PcName = Split (sTxtarea,vbCRLF)
	msgbox Ubound(PcName)
	strDriveLetter = localVariables.strDriveLetter.value
	strUser = localVariables.strUser.value
	strPassword = localVariables.strPassword.value
	remotefolder = localVariables.remotefolder.value
	Const strProfile = "false"
	
	'ON ERROR RESUME NEXT
	Const ForReading = 1, ForWriting = 2, ForAppending = 8, OpenAsDefault = -2, FailIfNotExist = 0	

	Dim objNetwork
	Dim objFSO
	Dim objShell
	Dim strLine1, strLine
	'Set objNetwork = WScript.CreateObject("WScript.Network")
	Set objNetwork = CreateObject("WScript.Network")
	Set objFSO = CreateObject("Scripting.FileSystemObject")
	'Set objShell = WScript.CreateObject("WScript.Shell") 
	Set objShell = CreateObject("WScript.Shell") 	
		For Each hostPC In PcName	
			strRemotePath = "\\"& hostPC &"\c$" 
			Set AllDrives = objNetwork.EnumNetworkDrives() 
			AlreadyConnected = False 
			For i = 0 To AllDrives.Count - 1 Step 2 
				If AllDrives.Item(i) = strDriveLetter Then AlreadyConnected = True 
			Next 
			If AlreadyConnected = True then 
				objNetwork.RemoveNetworkDrive strDriveLetter
				objNetwork.MapNetworkDrive strDriveLetter, strRemotePath, strProfile, strUser, strPassword
			Else 
				objNetwork.MapNetworkDrive strDriveLetter, strRemotePath, strProfile, strUser, strPassword
			End if
			
			objPathTMP = Split (remotefolder, ":",-1,1)
			objPath = strDriveLetter & ":" & objPathTMP(1)
			If Instr(objPath,"\") = 0 Then
				objPath = Replace(objPath,"/","\")
				Set objTextFile = objFso.OpenTextFile (resultName & ".txt", ForAppending, True,OpenAsDefault)
				objTextFile.WriteLine("File list at " & hostPC & " folder " & remotefolder)
				Set objFolder = objFso.GetFolder(objPath)
					For each objFile in objFolder.Files
						If objFolder.Files.Count > 0 Then
								objTextFile.WriteLine(objFile.Name & "," & objFile.Size)						
						End If				
					Next
				objTextFile.close
			ElseIf Instr(objPath,"\") > 0 Then
				Set objTextFile = objFso.OpenTextFile (resultName & ".txt", ForAppending, True,OpenAsDefault)
				objTextFile.WriteLine("File list at " & hostPC & " folder " & remotefolder)
				Set objFolder = objFso.GetFolder(objPath)
					For each objFile in objFolder.Files
						If objFolder.Files.Count > 0 Then
								objTextFile.WriteLine(objFile.Name & "," & objFile.Size)						
						End If				
					Next
				objTextFile.close
			End If

			Set AllDrives = objNetwork.EnumNetworkDrives() 
			AlreadyConnected = False 
			For i = 0 To AllDrives.Count - 1 Step 2 
				If AllDrives.Item(i) = strDriveLetter Then AlreadyConnected = True 
			Next 
			If AlreadyConnected = True then 
				intReturn = objShell.Popup("Releasing \\"& hostPC &"\c$ from " & strDriveLetter & ":Drive.", 2, "Check File Size Script", vbOKOnly)
				objNetwork.RemoveNetworkDrive strDriveLetter
				Wscript.Sleep 1000
			End if 
		Next
	Set objNetwork = Nothing
	Set objFSO = Nothing
	Set objShell = Nothing
	Set strLine1 = Nothing
	Set strLine = Nothing
	DataArea.InnerHtml = "Script completed. <br>Refer to generated file/s : " &  resultName & ".txt"
End Sub

</SCRIPT>

<body style="background-color:#42f4c8;">
<form name="localVariables">
Windows PC to check<br>
<TEXTAREA style="Height:300px;Width:150px;font-Size:12;font-weight:normal;background-color:pink;";TITLE=""; NAME="TextAreaPcName"; WRAP=hard>
PC-ABC
PC-DEF
PC-GHI</TEXTAREA>
<br>
Temporarily map network drive letter 	
<select name="strDriveLetter" style="font-weight:bold">
<!--<option value="G:"> &nbsp G:</option>
	<option value="H:"> &nbsp H:</option>
	<option value="I:"> &nbsp I:</option>
	<option value="J:"> &nbsp J:</option>
	<option value="K:"> &nbsp K:</option>
	<option value="L:"> &nbsp L:</option>-->
	<option value="M:"> &nbsp M:</option>
	<option value="N:"> &nbsp N:</option>
	<option value="O:"> &nbsp O:</option>
	<option value="P:"> &nbsp P:</option>
	<option value="Q:"> &nbsp Q:</option>
	<option value="R:"> &nbsp R:</option>
	<option value="S:"> &nbsp S:</option>
	<option value="T:"> &nbsp T:</option>
	<option value="U:"> &nbsp U:</option>
	<option value="V:"> &nbsp V:</option>		
</select>  to this PC for checking. &nbsp
<br>
<table style="width:100%">
<tr><td align=right> Check remote PC folder</td> <td> <input type="text" name="remotefolder" style="width:260px;background-color:yellow;" value="drive:\application\logs" > </td></tr>
<tr><td align=right>Remote PC Username</td>  <td><input type="text" name="strUser" style="width:260px;background-color:#f48942" ></td></tr>
<tr><td align=right>Password</td> <td><input type="password" name="strPassword" style="width:260px;background-color:#f48942" > </td></tr>
</table>
</form>

<input type="button" style="width:100px;height:25px" value="Submit" onClick="MainSub()" title="Map folder and collect file size.">
<input type="button" style="width:100px;height:25px" value="Quit" onClick="Logoff()" title="Close this window.">
<input type="button" style="width:100px;height:25px" value="Reset" onClick="RunReload()" title="Reset this window.">
<br>

<hr></hr>
<Span Id = "DataArea"></Span>
<br>

</body>
</html>
